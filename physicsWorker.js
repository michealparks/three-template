!function(){"use strict";let t,e,n;self.exports=self,importScripts("ammo.js");let o,s,i,r,a=[],c=0,l=0,u=0,w=0,b=0;onmessage=({data:d})=>{switch(d.operation){case"tick":return((t,d)=>{for(u=performance.now(),b=(u-w)/1e3,w=u,e.stepSimulation(b,10,.016666666666666666),c=1,l=a.length;c<l;)o=a[c],s=o.getMotionState(),s.getWorldTransform(n),i=n.getOrigin(),r=n.getRotation(),t[3*c+0]=i.x(),t[3*c+1]=i.y(),t[3*c+2]=i.z(),d[4*c+0]=r.x(),d[4*c+1]=r.y(),d[4*c+2]=r.z(),d[4*c+3]=r.w(),c+=1;postMessage({positions:t,quaternions:d},[t.buffer,d.buffer])})(d.positions,d.quaternions);case"init":return(async()=>{t=await self.Ammo();const o=new t.btDefaultCollisionConfiguration,s=new t.btCollisionDispatcher(o),i=new t.btDbvtBroadphase,r=new t.btSequentialImpulseConstraintSolver;e=new t.btDiscreteDynamicsWorld(s,i,r,o),e.setGravity(new t.btVector3(0,-9.81,0)),n=new t.btTransform,postMessage({init:!0})})();case"addBox":return((n,o,s,i=1)=>{const r=new t.btTransform;r.setIdentity(),r.setOrigin(new t.btVector3(n.x,n.y,n.z)),r.setRotation(new t.btQuaternion(o.x,o.y,o.z,o.w));const c=new t.btDefaultMotionState(r),l=new t.btBoxShape(new t.btVector3(s.x,s.y,s.z));l.setMargin(0);const u=new t.btVector3(0,0,0);0!==i&&l.calculateLocalInertia(i,u);const w=new t.btRigidBodyConstructionInfo(i,c,l,u),b=new t.btRigidBody(w);b.setRestitution(.5),b.setFriction(.5),t.destroy(w),t.destroy(u),e.addRigidBody(b),a.push(b)})(d.position,d.quaternion,d.volume,d.mass)}}}();

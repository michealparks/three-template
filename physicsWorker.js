let t,e,n;self.exports=self,importScripts("ammo.js");let o,i,s,r,a=[],c=0,l=0,w=0,u=0,b=0;onmessage=({data:d})=>{switch(d.operation){case"tick":return((t,d)=>{for(w=performance.now(),b=(w-u)/1e3,u=w,e.stepSimulation(b,10,.016666666666666666),c=1,l=a.length;c<l;)o=a[c],i=o.getMotionState(),i.getWorldTransform(n),s=n.getOrigin(),r=n.getRotation(),t[3*c+0]=s.x(),t[3*c+1]=s.y(),t[3*c+2]=s.z(),d[4*c+0]=r.x(),d[4*c+1]=r.y(),d[4*c+2]=r.z(),d[4*c+3]=r.w(),c+=1;postMessage({positions:t,quaternions:d},[t.buffer,d.buffer])})(d.positions,d.quaternions);case"init":return(async()=>{t=await self.Ammo();const o=new t.btDefaultCollisionConfiguration,i=new t.btCollisionDispatcher(o),s=new t.btDbvtBroadphase,r=new t.btSequentialImpulseConstraintSolver;e=new t.btDiscreteDynamicsWorld(i,s,r,o),e.setGravity(new t.btVector3(0,-9.81,0)),n=new t.btTransform,postMessage({init:!0})})();case"addBox":return((n,o,i,s=1)=>{const r=new t.btTransform;r.setIdentity(),r.setOrigin(new t.btVector3(n.x,n.y,n.z)),r.setRotation(new t.btQuaternion(o.x,o.y,o.z,o.w));const c=new t.btDefaultMotionState(r),l=new t.btBoxShape(new t.btVector3(i.x,i.y,i.z));l.setMargin(0);const w=new t.btVector3(0,0,0);0!==s&&l.calculateLocalInertia(s,w);const u=new t.btRigidBodyConstructionInfo(s,c,l,w);u.restitution=.5,u.friction=.5;const b=new t.btRigidBody(u);t.destroy(u),t.destroy(w),e.addRigidBody(b),a.push(b)})(d.position,d.quaternion,d.volume,d.mass)}};

!function(){"use strict";let t,e,n;self.exports=self,importScripts("ammo.js");let o,i,s,r,a=[],c=0,l=0,u=0,w=0,b=0;onmessage=({data:f})=>{switch(f.operation){case"tick":return((t,f)=>{for(u=performance.now(),b=(u-w)/1e3,w=u,e.stepSimulation(b,10,.016666666666666666),c=1,l=a.length;c<l;)o=a[c],i=o.getMotionState(),i.getWorldTransform(n),s=n.getOrigin(),r=n.getRotation(),t[3*c+0]=s.x(),t[3*c+1]=s.y(),t[3*c+2]=s.z(),f[4*c+0]=r.x(),f[4*c+1]=r.y(),f[4*c+2]=r.z(),f[4*c+3]=r.w(),c+=1;postMessage({positions:t,quaternions:f},[t.buffer,f.buffer])})(f.positions,f.quaternions);case"init":return(async()=>{t=await self.Ammo();const o=new t.btDefaultCollisionConfiguration,i=new t.btCollisionDispatcher(o),s=new t.btDbvtBroadphase,r=new t.btSequentialImpulseConstraintSolver;e=new t.btDiscreteDynamicsWorld(i,s,r,o),e.setGravity(new t.btVector3(0,-9.81,0)),n=new t.btTransform,postMessage({init:!0})})();case"addBox":return((n,o,i,s=1)=>{const r=new t.btTransform;r.setIdentity(),r.setOrigin(new t.btVector3(n.x,n.y,n.z)),r.setRotation(new t.btQuaternion(o.x,o.y,o.z,o.w));const c=new t.btDefaultMotionState(r),l=new t.btBoxShape(new t.btVector3(i.x,i.y,i.z));l.setMargin(0);const u=new t.btVector3(0,0,0);0!==s&&l.calculateLocalInertia(s,u);const w=new t.btRigidBodyConstructionInfo(s,c,l,u);w.restitution=.5,w.friction=.5;const b=new t.btRigidBody(w);t.destroy(w),t.destroy(u),e.addRigidBody(b),a.push(b)})(f.position,f.quaternion,f.volume,f.mass)}}}();
